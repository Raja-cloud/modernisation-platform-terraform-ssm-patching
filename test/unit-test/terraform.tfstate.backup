{
  "version": 4,
  "terraform_version": "1.3.1",
  "serial": 106,
  "lineage": "04c5a474-099e-5e21-08d8-1fbf4e44f735",
  "outputs": {
    "maintenance-window-id": {
      "value": "mw-0e6947944877064c6",
      "type": "string"
    },
    "patch-resource-group-arn": {
      "value": "arn:aws:resource-groups:eu-west-2:836052629367:group/testing-patch-group",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "aws_organizations_organization",
      "name": "root_account",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "accounts": null,
            "arn": "arn:aws:organizations::295814833350:organization/o-b2fpbzyd95",
            "aws_service_access_principals": [],
            "enabled_policy_types": [],
            "feature_set": "ALL",
            "id": "o-b2fpbzyd95",
            "master_account_arn": "arn:aws:organizations::295814833350:account/o-b2fpbzyd95/295814833350",
            "master_account_email": "aws+master@digital.justice.gov.uk",
            "master_account_id": "295814833350",
            "non_master_accounts": null,
            "roots": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_secretsmanager_secret",
      "name": "environment_management",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"].testing-ci-user",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:eu-west-2:946070829339:secret:environment_management-BLRCDb",
            "description": "IDs for AWS-specific resources for environment management, such as organizational unit IDs",
            "id": "arn:aws:secretsmanager:eu-west-2:946070829339:secret:environment_management-BLRCDb",
            "kms_key_id": "3a3a75ec-8d13-4e37-9667-b0face89551b",
            "name": "environment_management",
            "policy": "{\"Statement\":[{\"Action\":[\"secretsmanager:GetSecretValue\",\"secretsmanager:GetResourcePolicy\",\"secretsmanager:DescribeSecret\"],\"Condition\":{\"ForAnyValue:StringLike\":{\"aws:PrincipalOrgPaths\":\"o-b2fpbzyd95/*/ou-j1kx-qxsrh1gv/*\"}},\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":\"*\",\"Sid\":\"ReadOnlyFromModernisationPlatformOU\"}],\"Version\":\"2012-10-17\"}",
            "rotation_enabled": false,
            "rotation_lambda_arn": "",
            "rotation_rules": [],
            "tags": {
              "application": "Modernisation Platform: Environments Management",
              "business-unit": "Platforms",
              "is-production": "true",
              "owner": "Modernisation Platform: modernisation-platform@digital.justice.gov.uk"
            }
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "arn"
              }
            ]
          ]
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_secretsmanager_secret_version",
      "name": "environment_management",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"].testing-ci-user",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:eu-west-2:946070829339:secret:environment_management-BLRCDb",
            "id": "arn:aws:secretsmanager:eu-west-2:946070829339:secret:environment_management-BLRCDb|AWSCURRENT",
            "secret_binary": "",
            "secret_id": "arn:aws:secretsmanager:eu-west-2:946070829339:secret:environment_management-BLRCDb",
            "secret_string": "{\"account_ids\":{\"analytical-platform-data-development\":\"803963757240\",\"analytical-platform-management-production\":\"042130406152\",\"apex-development\":\"573115265413\",\"bichard7-sandbox-a\":\"454061736096\",\"bichard7-sandbox-b\":\"108839434327\",\"bichard7-sandbox-c\":\"744728743481\",\"bichard7-sandbox-shared\":\"258361008057\",\"bichard7-shared\":\"497078235711\",\"bichard7-test-current\":\"439237763202\",\"bichard7-test-next\":\"581823340673\",\"ccms-ebs-development\":\"767123802783\",\"cooker-development\":\"236861075084\",\"core-logging-production\":\"624384546187\",\"core-network-services-production\":\"505974653433\",\"core-sandbox-dev\":\"763252494486\",\"core-security-production\":\"744927879746\",\"core-shared-services-production\":\"374269020027\",\"core-vpc-development\":\"991589384446\",\"core-vpc-preproduction\":\"453136268281\",\"core-vpc-production\":\"278663825216\",\"core-vpc-sandbox\":\"267053793615\",\"core-vpc-test\":\"794399914478\",\"data-and-insights-wepi-development\":\"289153439536\",\"data-and-insights-wepi-preproduction\":\"189100541811\",\"data-and-insights-wepi-production\":\"866445910544\",\"delius-iaps-development\":\"744472264485\",\"delius-iaps-production\":\"936195311149\",\"digital-prison-reporting-development\":\"771283872747\",\"equip-development\":\"608897814635\",\"equip-production\":\"647473535058\",\"example-development\":\"083957762049\",\"maatdb-development\":\"110341342196\",\"mi-platform-development\":\"967617145656\",\"mlra-development\":\"890609150221\",\"nomis-development\":\"327850556621\",\"nomis-preproduction\":\"145445613877\",\"nomis-production\":\"272983201692\",\"nomis-test\":\"612659970365\",\"oasys-development\":\"003430027717\",\"oasys-preproduction\":\"450842467489\",\"oasys-production\":\"006231045038\",\"oasys-test\":\"546088120047\",\"performance-hub-development\":\"938841708445\",\"performance-hub-preproduction\":\"322518575883\",\"performance-hub-production\":\"143664002102\",\"ppud-development\":\"075585660276\",\"ppud-production\":\"817985104434\",\"refer-monitor-development\":\"534609872573\",\"remote-supervision-non-production\":\"283184878391\",\"remote-supervision-production\":\"053800769812\",\"sprinkler-development\":\"348456244381\",\"tariff-development\":\"566373822119\",\"testing-test\":\"836052629367\",\"threat-and-vulnerability-mgmt-development\":\"532211371847\",\"threat-and-vulnerability-mgmt-production\":\"871220710208\",\"xhibit-portal-development\":\"276038508461\",\"xhibit-portal-preproduction\":\"257452857869\",\"xhibit-portal-production\":\"674345106521\"},\"aws_organizations_root_account_id\":\"295814833350\",\"modernisation_platform_account_id\":\"946070829339\",\"modernisation_platform_organisation_unit_id\":\"ou-j1kx-qxsrh1gv\"}",
            "version_id": "E1F4E7D7-94AB-4B2A-9F57-0AA49D6049FE",
            "version_stage": "AWSCURRENT",
            "version_stages": [
              "AWSCURRENT"
            ]
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_ssm_parameter",
      "name": "environment_management_arn",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"].testing-ci-user",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ssm:eu-west-2:836052629367:parameter/environment_management_arn",
            "id": "environment_management_arn",
            "name": "environment_management_arn",
            "type": "SecureString",
            "value": "arn:aws:secretsmanager:eu-west-2:946070829339:secret:environment_management-BLRCDb",
            "version": 1,
            "with_decryption": true
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "http",
      "name": "environments_file",
      "provider": "provider[\"registry.terraform.io/hashicorp/http\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "body": "{\n\t\"account-type\": \"member\",\n\t\"environments\": [\n    {\n      \"name\": \"test\",\n      \"access\": [\n        {\n          \"github_slug\": \"modernisation-platform\",\n          \"level\": \"developer\"\n        }\n      ]\n    }\n\t],\n\t\"tags\": {\n\t\t\"application\": \"testing\",\n\t\t\"business-unit\": \"Platforms\",\n\t\t\"owner\": \"Modernisation Platform: modernisation-platform@digital.justice.gov.uk\"\n\t}\n}\n",
            "ca_cert_pem": null,
            "id": "https://raw.githubusercontent.com/ministryofjustice/modernisation-platform/main/environments/testing.json",
            "insecure": null,
            "method": null,
            "request_body": null,
            "request_headers": null,
            "response_body": "{\n\t\"account-type\": \"member\",\n\t\"environments\": [\n    {\n      \"name\": \"test\",\n      \"access\": [\n        {\n          \"github_slug\": \"modernisation-platform\",\n          \"level\": \"developer\"\n        }\n      ]\n    }\n\t],\n\t\"tags\": {\n\t\t\"application\": \"testing\",\n\t\t\"business-unit\": \"Platforms\",\n\t\t\"owner\": \"Modernisation Platform: modernisation-platform@digital.justice.gov.uk\"\n\t}\n}\n",
            "response_headers": {
              "Accept-Ranges": "bytes",
              "Access-Control-Allow-Origin": "*",
              "Cache-Control": "max-age=300",
              "Content-Security-Policy": "default-src 'none'; style-src 'unsafe-inline'; sandbox",
              "Content-Type": "text/plain; charset=utf-8",
              "Date": "Tue, 29 Nov 2022 10:41:17 GMT",
              "Etag": "W/\"ad8444f6b9e0f135f2622ab26cec2a7f1e47d766c2bca183d036ff2a114d77dd\"",
              "Expires": "Tue, 29 Nov 2022 10:46:17 GMT",
              "Source-Age": "220",
              "Strict-Transport-Security": "max-age=31536000",
              "Vary": "Authorization,Accept-Encoding,Origin",
              "Via": "1.1 varnish",
              "X-Cache": "HIT",
              "X-Cache-Hits": "1",
              "X-Content-Type-Options": "nosniff",
              "X-Fastly-Request-Id": "16e792567ee0493fb8d71711a18bc7d498738766",
              "X-Frame-Options": "deny",
              "X-Github-Request-Id": "0DD4:8ABF:1A1E5E:1C89DC:6385DB94",
              "X-Served-By": "cache-lhr7347-LHR",
              "X-Timer": "S1669718478.816316,VS0,VE2",
              "X-Xss-Protection": "1; mode=block"
            },
            "status_code": 200,
            "url": "https://raw.githubusercontent.com/ministryofjustice/modernisation-platform/main/environments/testing.json"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "data",
      "type": "aws_elb_service_account",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::652711504416:root",
            "id": "652711504416",
            "region": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "bucket_policy",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "487561553",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::652711504416:root\"\n      }\n    },\n    {\n      \"Sid\": \"AWSLogDeliveryWrite\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*\",\n      \"Principal\": {\n        \"Service\": \"delivery.logs.amazonaws.com\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n        }\n      }\n    },\n    {\n      \"Sid\": \"AWSLogDeliveryAclCheck\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:GetBucketAcl\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs\",\n      \"Principal\": {\n        \"Service\": \"delivery.logs.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "override_policy_documents": null,
            "policy_id": null,
            "source_json": null,
            "source_policy_documents": null,
            "statement": [
              {
                "actions": [
                  "s3:PutObject"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "arn:aws:iam::652711504416:root"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "s3:PutObject"
                ],
                "condition": [
                  {
                    "test": "StringEquals",
                    "values": [
                      "bucket-owner-full-control"
                    ],
                    "variable": "s3:x-amz-acl"
                  }
                ],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "delivery.logs.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [
                  "arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*"
                ],
                "sid": "AWSLogDeliveryWrite"
              },
              {
                "actions": [
                  "s3:GetBucketAcl"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "delivery.logs.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [
                  "arn:aws:s3:::testing-ssm-patching-logs"
                ],
                "sid": "AWSLogDeliveryAclCheck"
              }
            ],
            "version": "2012-10-17"
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "statement"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "resources"
              }
            ],
            [
              {
                "type": "get_attr",
                "value": "statement"
              },
              {
                "type": "index",
                "value": {
                  "value": 1,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "resources"
              }
            ]
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "ssm-admin-policy-doc",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "3975698373",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ssm:*\",\n        \"s3:*\",\n        \"lambda:*\",\n        \"iam:*\",\n        \"ec2:*\",\n        \"cloudwatch:*\",\n        \"cloudformation:*\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}",
            "override_json": null,
            "override_policy_documents": null,
            "policy_id": null,
            "source_json": null,
            "source_policy_documents": null,
            "statement": [
              {
                "actions": [
                  "cloudformation:*",
                  "cloudwatch:*",
                  "ec2:*",
                  "iam:*",
                  "lambda:*",
                  "s3:*",
                  "ssm:*"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "managed",
      "type": "aws_iam_policy",
      "name": "ssm-patching-iam-policy",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::836052629367:policy/ssm-patching-iam-policy",
            "description": "IAM Policy for the AWS-PatchAsgInstance automation script that runs as part of the module",
            "id": "arn:aws:iam::836052629367:policy/ssm-patching-iam-policy",
            "name": "ssm-patching-iam-policy",
            "name_prefix": null,
            "path": "/",
            "policy": "{\"Statement\":[{\"Action\":[\"ssm:*\",\"s3:*\",\"lambda:*\",\"iam:*\",\"ec2:*\",\"cloudwatch:*\",\"cloudformation:*\"],\"Effect\":\"Allow\",\"Resource\":\"*\",\"Sid\":\"\"}],\"Version\":\"2012-10-17\"}",
            "policy_id": "ANPA4FKE6W53RYAJZ3WNU",
            "tags": null,
            "tags_all": {}
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "module.ssm-auto-patching.data.aws_iam_policy_document.ssm-admin-policy-doc"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "ssm-patching-iam-role",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::836052629367:role/ssm-patching-iam-role",
            "assume_role_policy": "{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":[\"ssm.amazonaws.com\",\"iam.amazonaws.com\"]}}],\"Version\":\"2012-10-17\"}",
            "create_date": "2022-11-29T10:41:21Z",
            "description": "",
            "force_detach_policies": false,
            "id": "ssm-patching-iam-role",
            "inline_policy": [],
            "managed_policy_arns": [],
            "max_session_duration": 3600,
            "name": "ssm-patching-iam-role",
            "name_prefix": "",
            "path": "/",
            "permissions_boundary": null,
            "tags": null,
            "tags_all": {},
            "unique_id": "AROA4FKE6W533YQQ3ZUX7"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "ssm-admin-automation",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "ssm-patching-iam-role-20221129104122671800000001",
            "policy_arn": "arn:aws:iam::836052629367:policy/ssm-patching-iam-policy",
            "role": "ssm-patching-iam-role"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "module.ssm-auto-patching.aws_iam_policy.ssm-patching-iam-policy",
            "module.ssm-auto-patching.aws_iam_role.ssm-patching-iam-role",
            "module.ssm-auto-patching.data.aws_iam_policy_document.ssm-admin-policy-doc"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "managed",
      "type": "aws_resourcegroups_group",
      "name": "patch-resource-group",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:resource-groups:eu-west-2:836052629367:group/testing-patch-group",
            "configuration": [],
            "description": "",
            "id": "testing-patch-group",
            "name": "testing-patch-group",
            "resource_query": [
              {
                "query": "{\n   \"ResourceTypeFilters\":[\n      \"AWS::EC2::Instance\"\n   ],\n   \"TagFilters\":[\n      {\n         \"Key\":\"Patching\",\n         \"Values\":[\"Yes\"]\n      }\n   ]\n}\n",
                "type": "TAG_FILTERS_1_0"
              }
            ],
            "tags": null,
            "tags_all": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo5MDAwMDAwMDAwMDAsInVwZGF0ZSI6OTAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "managed",
      "type": "aws_ssm_maintenance_window",
      "name": "ssm-maintenance-window",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allow_unassociated_targets": false,
            "cutoff": 3,
            "description": "",
            "duration": 4,
            "enabled": true,
            "end_date": "",
            "id": "mw-0e6947944877064c6",
            "name": "testing-maintenance-window",
            "schedule": "cron(30 17 ? * MON *)",
            "schedule_offset": 0,
            "schedule_timezone": "",
            "start_date": "",
            "tags": null,
            "tags_all": {}
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "managed",
      "type": "aws_ssm_maintenance_window_target",
      "name": "ssm-maintenance-window-target",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "This is a maintenance window target",
            "id": "d4ab9942-7a2f-4c15-87ef-6369be88a1ef",
            "name": "maintenance-window-target",
            "owner_information": "",
            "resource_type": "INSTANCE",
            "targets": [
              {
                "key": "tag:Patching",
                "values": [
                  "Yes"
                ]
              }
            ],
            "window_id": "mw-0e6947944877064c6"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "module.ssm-auto-patching.aws_ssm_maintenance_window.ssm-maintenance-window"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "managed",
      "type": "aws_ssm_maintenance_window_task",
      "name": "ssm-maintenance-window-automation-task",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ssm:eu-west-2:836052629367:windowtask/878a2d9f-af47-4d7d-a657-f0237865b76c",
            "cutoff_behavior": "",
            "description": "",
            "id": "878a2d9f-af47-4d7d-a657-f0237865b76c",
            "max_concurrency": "20",
            "max_errors": "10",
            "name": "testing-automation-patching-task",
            "priority": 1,
            "service_role_arn": "arn:aws:iam::836052629367:role/ssm-patching-iam-role",
            "targets": [
              {
                "key": "WindowTargetIds",
                "values": [
                  "d4ab9942-7a2f-4c15-87ef-6369be88a1ef"
                ]
              }
            ],
            "task_arn": "AWS-PatchInstanceWithRollback",
            "task_invocation_parameters": [
              {
                "automation_parameters": [
                  {
                    "document_version": "$LATEST",
                    "parameter": [
                      {
                        "name": "InstanceId",
                        "values": [
                          "{{RESOURCE_ID}}"
                        ]
                      },
                      {
                        "name": "ReportS3Bucket",
                        "values": [
                          "testing-ssm-patching-logs"
                        ]
                      }
                    ]
                  }
                ],
                "lambda_parameters": [],
                "run_command_parameters": [],
                "step_functions_parameters": []
              }
            ],
            "task_type": "AUTOMATION",
            "window_id": "mw-0e6947944877064c6",
            "window_task_id": "878a2d9f-af47-4d7d-a657-f0237865b76c"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "module.ssm-auto-patching.aws_iam_role.ssm-patching-iam-role",
            "module.ssm-auto-patching.aws_ssm_maintenance_window.ssm-maintenance-window",
            "module.ssm-auto-patching.aws_ssm_maintenance_window_target.ssm-maintenance-window-target"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching",
      "mode": "managed",
      "type": "aws_ssm_patch_baseline",
      "name": "patch-baseline-poc",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "approval_rule": [
              {
                "approve_after_days": 7,
                "approve_until_date": "",
                "compliance_level": "CRITICAL",
                "enable_non_security": false,
                "patch_filter": [
                  {
                    "key": "CLASSIFICATION",
                    "values": [
                      "Security"
                    ]
                  }
                ]
              }
            ],
            "approved_patches": null,
            "approved_patches_compliance_level": "UNSPECIFIED",
            "approved_patches_enable_non_security": false,
            "arn": "arn:aws:ssm:eu-west-2:836052629367:patchbaseline/pb-00a7f36c18eb0830a",
            "description": "",
            "global_filter": [],
            "id": "pb-00a7f36c18eb0830a",
            "name": "testing-baseline",
            "operating_system": "CENTOS",
            "rejected_patches": null,
            "rejected_patches_action": "ALLOW_AS_DEPENDENCY",
            "source": [],
            "tags": null,
            "tags_all": {}
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching.module.s3-bucket[0]",
      "mode": "data",
      "type": "aws_caller_identity",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "account_id": "836052629367",
            "arn": "arn:aws:sts::836052629367:assumed-role/ModernisationPlatformAccess/aws-go-sdk-1669718478725552000",
            "id": "836052629367",
            "user_id": "AROA4FKE6W53RMK5EQVSN:aws-go-sdk-1669718478725552000"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching.module.s3-bucket[0]",
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "2423292219",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Deny\",\n      \"Action\": \"s3:*\",\n      \"Resource\": [\n        \"arn:aws:s3:::testing-ssm-patching-logs/*\",\n        \"arn:aws:s3:::testing-ssm-patching-logs\"\n      ],\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"Bool\": {\n          \"aws:SecureTransport\": \"false\"\n        }\n      }\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::652711504416:root\"\n      }\n    },\n    {\n      \"Sid\": \"AWSLogDeliveryWrite\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*\",\n      \"Principal\": {\n        \"Service\": \"delivery.logs.amazonaws.com\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"s3:x-amz-acl\": [\n            \"bucket-owner-full-control\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"AWSLogDeliveryAclCheck\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:GetBucketAcl\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs\",\n      \"Principal\": {\n        \"Service\": \"delivery.logs.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "override_policy_documents": [
              "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::652711504416:root\"\n      }\n    },\n    {\n      \"Sid\": \"AWSLogDeliveryWrite\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*\",\n      \"Principal\": {\n        \"Service\": \"delivery.logs.amazonaws.com\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n        }\n      }\n    },\n    {\n      \"Sid\": \"AWSLogDeliveryAclCheck\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:GetBucketAcl\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs\",\n      \"Principal\": {\n        \"Service\": \"delivery.logs.amazonaws.com\"\n      }\n    }\n  ]\n}"
            ],
            "policy_id": null,
            "source_json": null,
            "source_policy_documents": null,
            "statement": [
              {
                "actions": [
                  "s3:*"
                ],
                "condition": [
                  {
                    "test": "Bool",
                    "values": [
                      "false"
                    ],
                    "variable": "aws:SecureTransport"
                  }
                ],
                "effect": "Deny",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "*"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "arn:aws:s3:::testing-ssm-patching-logs",
                  "arn:aws:s3:::testing-ssm-patching-logs/*"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching.module.s3-bucket[0]",
      "mode": "managed",
      "type": "aws_s3_bucket",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acceleration_status": "",
            "acl": null,
            "arn": "arn:aws:s3:::testing-ssm-patching-logs",
            "bucket": "testing-ssm-patching-logs",
            "bucket_domain_name": "testing-ssm-patching-logs.s3.amazonaws.com",
            "bucket_prefix": null,
            "bucket_regional_domain_name": "testing-ssm-patching-logs.s3.eu-west-2.amazonaws.com",
            "cors_rule": [],
            "force_destroy": false,
            "grant": [
              {
                "id": "83fb245dfce697d300eb2b9c7320bf9916e938f0bc6c590aafda6a0abfedf37b",
                "permissions": [
                  "FULL_CONTROL"
                ],
                "type": "CanonicalUser",
                "uri": ""
              }
            ],
            "hosted_zone_id": "Z3GKZC51ZF0DB4",
            "id": "testing-ssm-patching-logs",
            "lifecycle_rule": [],
            "logging": [],
            "object_lock_configuration": [],
            "object_lock_enabled": false,
            "policy": "",
            "region": "eu-west-2",
            "replication_configuration": [],
            "request_payer": "BucketOwner",
            "server_side_encryption_configuration": [],
            "tags": {
              "Name": "ssm-patching",
              "application": "testing",
              "business-unit": "Platforms",
              "environment-name": "default",
              "is-production": "false",
              "owner": "Modernisation Platform: modernisation-platform@digital.justice.gov.uk",
              "source-code": "https://github.com/ministryofjustice/modernisation-platform"
            },
            "tags_all": {
              "Name": "ssm-patching",
              "application": "testing",
              "business-unit": "Platforms",
              "environment-name": "default",
              "is-production": "false",
              "owner": "Modernisation Platform: modernisation-platform@digital.justice.gov.uk",
              "source-code": "https://github.com/ministryofjustice/modernisation-platform"
            },
            "timeouts": null,
            "versioning": [
              {
                "enabled": false,
                "mfa_delete": false
              }
            ],
            "website": [],
            "website_domain": null,
            "website_endpoint": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "data.http.environments_file"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching.module.s3-bucket[0]",
      "mode": "managed",
      "type": "aws_s3_bucket_acl",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "access_control_policy": [
              {
                "grant": [
                  {
                    "grantee": [
                      {
                        "display_name": "",
                        "email_address": "",
                        "id": "83fb245dfce697d300eb2b9c7320bf9916e938f0bc6c590aafda6a0abfedf37b",
                        "type": "CanonicalUser",
                        "uri": ""
                      }
                    ],
                    "permission": "FULL_CONTROL"
                  }
                ],
                "owner": [
                  {
                    "display_name": "",
                    "id": "83fb245dfce697d300eb2b9c7320bf9916e938f0bc6c590aafda6a0abfedf37b"
                  }
                ]
              }
            ],
            "acl": "private",
            "bucket": "testing-ssm-patching-logs",
            "expected_bucket_owner": "",
            "id": "testing-ssm-patching-logs,private"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "data.http.environments_file",
            "module.ssm-auto-patching.module.s3-bucket.aws_s3_bucket.default"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching.module.s3-bucket[0]",
      "mode": "managed",
      "type": "aws_s3_bucket_lifecycle_configuration",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "bucket": "testing-ssm-patching-logs",
            "expected_bucket_owner": "",
            "id": "testing-ssm-patching-logs",
            "rule": [
              {
                "abort_incomplete_multipart_upload": [
                  {
                    "days_after_initiation": 7
                  }
                ],
                "expiration": [
                  {
                    "date": "",
                    "days": 730,
                    "expired_object_delete_marker": false
                  }
                ],
                "filter": [
                  {
                    "and": [],
                    "object_size_greater_than": null,
                    "object_size_less_than": null,
                    "prefix": "",
                    "tag": []
                  }
                ],
                "id": "main",
                "noncurrent_version_expiration": [
                  {
                    "newer_noncurrent_versions": "",
                    "noncurrent_days": 730
                  }
                ],
                "noncurrent_version_transition": [
                  {
                    "newer_noncurrent_versions": "",
                    "noncurrent_days": 365,
                    "storage_class": "GLACIER"
                  },
                  {
                    "newer_noncurrent_versions": "",
                    "noncurrent_days": 90,
                    "storage_class": "STANDARD_IA"
                  }
                ],
                "prefix": "",
                "status": "Enabled",
                "transition": [
                  {
                    "date": "",
                    "days": 365,
                    "storage_class": "GLACIER"
                  },
                  {
                    "date": "",
                    "days": 90,
                    "storage_class": "STANDARD_IA"
                  }
                ]
              }
            ]
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "data.http.environments_file",
            "module.ssm-auto-patching.module.s3-bucket.aws_s3_bucket.default"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching.module.s3-bucket[0]",
      "mode": "managed",
      "type": "aws_s3_bucket_policy",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "bucket": "testing-ssm-patching-logs",
            "id": "testing-ssm-patching-logs",
            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Deny\",\n      \"Action\": \"s3:*\",\n      \"Resource\": [\n        \"arn:aws:s3:::testing-ssm-patching-logs/*\",\n        \"arn:aws:s3:::testing-ssm-patching-logs\"\n      ],\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"Bool\": {\n          \"aws:SecureTransport\": \"false\"\n        }\n      }\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::652711504416:root\"\n      }\n    },\n    {\n      \"Sid\": \"AWSLogDeliveryWrite\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs/testing/AWSLogs/836052629367/*\",\n      \"Principal\": {\n        \"Service\": \"delivery.logs.amazonaws.com\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"s3:x-amz-acl\": [\n            \"bucket-owner-full-control\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"AWSLogDeliveryAclCheck\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:GetBucketAcl\",\n      \"Resource\": \"arn:aws:s3:::testing-ssm-patching-logs\",\n      \"Principal\": {\n        \"Service\": \"delivery.logs.amazonaws.com\"\n      }\n    }\n  ]\n}"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "data.http.environments_file",
            "module.ssm-auto-patching.data.aws_elb_service_account.default",
            "module.ssm-auto-patching.data.aws_iam_policy_document.bucket_policy",
            "module.ssm-auto-patching.module.s3-bucket.aws_s3_bucket.default",
            "module.ssm-auto-patching.module.s3-bucket.aws_s3_bucket_public_access_block.default",
            "module.ssm-auto-patching.module.s3-bucket.data.aws_iam_policy_document.default"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching.module.s3-bucket[0]",
      "mode": "managed",
      "type": "aws_s3_bucket_public_access_block",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "block_public_acls": true,
            "block_public_policy": true,
            "bucket": "testing-ssm-patching-logs",
            "id": "testing-ssm-patching-logs",
            "ignore_public_acls": true,
            "restrict_public_buckets": true
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "data.http.environments_file",
            "module.ssm-auto-patching.module.s3-bucket.aws_s3_bucket.default"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching.module.s3-bucket[0]",
      "mode": "managed",
      "type": "aws_s3_bucket_server_side_encryption_configuration",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "bucket": "testing-ssm-patching-logs",
            "expected_bucket_owner": "",
            "id": "testing-ssm-patching-logs",
            "rule": [
              {
                "apply_server_side_encryption_by_default": [
                  {
                    "kms_master_key_id": "",
                    "sse_algorithm": "aws:kms"
                  }
                ],
                "bucket_key_enabled": null
              }
            ]
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "data.http.environments_file",
            "module.ssm-auto-patching.module.s3-bucket.aws_s3_bucket.default"
          ]
        }
      ]
    },
    {
      "module": "module.ssm-auto-patching.module.s3-bucket[0]",
      "mode": "managed",
      "type": "aws_s3_bucket_versioning",
      "name": "default",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "bucket": "testing-ssm-patching-logs",
            "expected_bucket_owner": "",
            "id": "testing-ssm-patching-logs",
            "mfa": null,
            "versioning_configuration": [
              {
                "mfa_delete": "",
                "status": "Enabled"
              }
            ]
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.environment_management",
            "data.http.environments_file",
            "module.ssm-auto-patching.module.s3-bucket.aws_s3_bucket.default"
          ]
        }
      ]
    }
  ],
  "check_results": []
}
